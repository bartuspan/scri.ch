var b=null,d=!1,f=this,g=this.document;function h(a,c){var e=j.getImageData(0,0,k.width,k.height);k.width=l||a||(f.innerWidth-2*m>p?f.innerWidth-2*m:p);k.height=q||c||(f.innerHeight-2*m>r?f.innerHeight-2*m:r);l&&(s=f.innerWidth/2-l/2,k.style.left=s+"px");q&&(t=f.innerHeight/2-q/2,k.style.top=t+"px");u.width=e.width;u.height=e.height;x.putImageData(e,0,0);"transparent"!==y&&(j.fillStyle=y,j.fillRect(0,0,k.width,k.height));j.drawImage(u,0,0)}
function z(a){a.preventDefault();var c=A(a);a=c.x;var c=c.y,e=a+1,n=c+1;e>p&&(p=e);n>r&&(r=n);j.strokeStyle=C;j.lineTo(a,c);j.stroke()}function D(a){a=A(a);var c=a.x,e=a.y,n=c+1,v=e+1;n>p&&(p=n);v>r&&(r=v);j.fillStyle=C;j.fillRect(c-1,e-1,2,2);j.beginPath();j.moveTo(a.x,a.y);if(!E){E=!0;a=[F,G,H];for(c=function(a){a.stopPropagation()};a.length;)e=a.shift(),e.style.display="block",e.addEventListener("mousedown",c,d)}f.addEventListener("mousemove",z,d);k.addEventListener("touchmove",z,d)}
function I(){j.stroke();f.removeEventListener("mousemove",z,d);k.removeEventListener("touchmove",z,d)}function A(a){return{x:(a.touches?a.touches[0].pageX:a.pageX)-m-s,y:(a.touches?a.touches[0].pageY:a.pageY)-m-t}}
function J(){function a(){g.title="Draw! "+(w?"":n)+v+(w?n:"");w=!w;B=f.setTimeout(a,300)}0<m&&(K.push("margin"),k.style.left=m+"px",k.style.top=m+"px");y&&(K.push("margin"),k.style.left=m+"px",k.style.top=m+"px");0<K.length&&(k.className=K.join(" "));f.addEventListener("resize",function(){h()},d);h();var c,e=g.title,n="\u00a0",v="\u270e",w=!0,B;B=f.setTimeout(a,4E3);c={stop:function(){f.clearTimeout(B);g.title=e}};g.body.addEventListener("touchmove",function(a){a.preventDefault()},d);k.addEventListener("mousedown",
function(a){0===a.button&&(D(a),c&&(c.stop(),c=b))},!0);k.addEventListener("touchstart",function(a){a.preventDefault();D(a);c&&(c.stop(),c=b)},d);f.addEventListener("mouseup",I,d);k.addEventListener("touchend",I,d);F.onclick=function(){var a=k.width,c=k.height;h(p,r);0<p&&0<r&&(L.value=JSON.stringify(f.SCRICH_SETTINGS),M.value=k.toDataURL("image/png").replace(/^data:image\/png;base64,/,""),N.submit());h(a,c)};G.onclick=function(){f.location=f.SCRICH_URL}}
var k=g.getElementById("drawing"),F=g.getElementById("save"),G=g.getElementById("new"),O=g.getElementById("img"),N=g.getElementById("form"),M=g.getElementById("new_drawing"),L=g.getElementById("settings"),H=g.getElementById("about"),p=0,r=0,E=d,j=b,u=b,x=b,m=b,y=b,C=b,l=b,q=b,K=[],s=0,t=0;
if(k.getContext){j=k.getContext("2d");u=g.createElement("canvas");x=u.getContext("2d");m=f.SCRICH_SETTINGS.margin||0;y=f.SCRICH_SETTINGS.background||"transparent";C=f.SCRICH_SETTINGS.foreground||"#000000";f.SCRICH_SETTINGS.size&&(l=f.SCRICH_SETTINGS.size.width||b,q=f.SCRICH_SETTINGS.size.height||b,m=0);g.onselectstart=function(){return d};var P=f.b=function(a,c){var e=new f.a;e.onload=function(){k.width=p=e.width;k.height=r=e.height;try{j.drawImage(e,0,0)}catch(n){f.setTimeout(function(){P(a,c)},
300)}c&&c()};e.src=a};O?P(O.src,J):J()}else f.alert("Your browser does not support canvas, you need to update it before using scri.ch.");
