var g=null;
(function(c,r){function k(a,l){var f=e.getImageData(0,0,b.width,b.height);b.width=m||a||(c.innerWidth-d*2>h?c.innerWidth-d*2:h);b.height=n||l||(c.innerHeight-d*2>i?c.innerHeight-d*2:i);if(m)s=c.innerWidth/2-m/2,b.style.left=s+"px";if(n)t=c.innerHeight/2-n/2,b.style.top=t+"px";j.width=f.width;j.height=f.height;v.putImageData(f,0,0);if(o!=="transparent")e.fillStyle=o,e.fillRect(0,0,b.width,b.height);e.drawImage(j,0,0)}function w(a){if(a.button!==2){var a=x(a),l=a.x,f=a.y,d=l+1,j=f+1;d>h&&(h=d);j>i&&
(i=j);e.fillStyle=u;e.fillRect(l-1,f-1,2,2);e.beginPath();e.moveTo(a.x,a.y);F();c.addEventListener("mousemove",p,!1);b.addEventListener("touchmove",p,!1)}}function y(){e.stroke();c.removeEventListener("mousemove",p,!1);b.removeEventListener("touchmove",p,!1)}function F(){if(!z){z=!0;for(var a=[A,B,G],b=function(a){a.stopPropagation()};a.length;){var c=a.shift();c.style.display="block";c.addEventListener("mousedown",b,!1)}}}function p(a){a.preventDefault();var b=x(a),a=b.x,b=b.y,c=a+1,d=b+1;c>h&&(h=
c);d>i&&(i=d);e.strokeStyle=u;e.lineTo(a,b);e.stroke()}function x(a){return{x:(a.touches?a.touches[0].pageX:a.pageX)-d-s,y:(a.touches?a.touches[0].pageY:a.pageY)-d-t}}function C(){if(d>0)q.push("margin"),b.style.left=d+"px",b.style.top=d+"px";if(o)q.push("margin"),b.style.left=d+"px",b.style.top=d+"px";if(q.length>0)b.className=q.join(" ");c.addEventListener("resize",function(){k()},!1);k();r.body.addEventListener("touchmove",function(a){a.preventDefault()},!1);b.addEventListener("mousedown",w,!0);
b.addEventListener("touchstart",function(a){a.preventDefault();w(a)},!1);c.addEventListener("mouseup",y,!1);b.addEventListener("touchend",y,!1);A.onclick=function(){var a=b.width,d=b.height;k(h,i);if(h>0&&i>0)H.value=JSON.stringify(c.SCRICH_SETTINGS),I.value=b.toDataURL("image/png").replace(/^data:image\/png;base64,/,""),J.submit();k(a,d)};B.onclick=function(){c.location=c.SCRICH_URL}}var b=document.getElementById("drawing"),A=document.getElementById("save"),B=document.getElementById("new"),D=document.getElementById("img"),
J=document.getElementById("form"),I=document.getElementById("new_drawing"),H=document.getElementById("settings"),G=document.getElementById("about"),h=0,i=0,z=!1,e=g,j=g,v=g,d=g,o=g,u=g,m=g,n=g,q=[],s=0,t=0;if(b.getContext){e=b.getContext("2d");j=r.createElement("canvas");v=j.getContext("2d");d=c.SCRICH_SETTINGS.margin||0;o=c.SCRICH_SETTINGS.background||"transparent";u=c.SCRICH_SETTINGS.foreground||"#000000";c.SCRICH_SETTINGS.size&&(m=c.SCRICH_SETTINGS.size.width||g,n=c.SCRICH_SETTINGS.size.height||
g,d=0);r.onselectstart=function(){return!1};var E=c.a=function(a,d){var f=new Image;f.onload=function(){b.width=h=f.width;b.height=i=f.height;try{e.drawImage(f,0,0)}catch(j){c.setTimeout(function(){E(a,d)},300)}d&&d()};f.src=a};D?E(D.src,C):C()}else c.alert("Your browser does not support canvas, you need to update it before using scri.ch.")})(window,document);
