(function(t,e){function n(e,n){var i=x.getImageData(0,0,f.width,f.height);f.width=_||e||(t.innerWidth-2*H>E?t.innerWidth-2*H:E),f.height=k||n||(t.innerHeight-2*H>T?t.innerHeight-2*H:T),_&&(G=t.innerWidth/2-_/2,f.style.left=G+"px"),k&&(z=t.innerHeight/2-k/2,f.style.top=z+"px"),L.width=i.width,L.height=i.height,R.putImageData(i,0,0),"transparent"!==b&&(x.fillStyle=b,x.fillRect(0,0,f.width,f.height)),x.drawImage(L,0,0)}function i(t){t.preventDefault();var e=s(t);r(e.x,e.y)}function o(e){var n=s(e);u(n.x,n.y),x.beginPath(),x.moveTo(n.x,n.y),l(),t.addEventListener("mousemove",i,!1),f.addEventListener("touchmove",i,!1)}function a(){x.stroke(),t.removeEventListener("mousemove",i,!1),f.removeEventListener("touchmove",i,!1)}function u(t,e){c(t+1,e+1),x.fillStyle=N,x.fillRect(t-1,e-1,2,2)}function r(t,e){c(t+1,e+1),x.strokeStyle=N,x.lineTo(t,e),x.stroke()}function l(){if(!C){C=!0;for(var t=[v,m,y],e=function(t){t.stopPropagation()};t.length;){var n=t.shift();n.style.display="block",n.addEventListener("mousedown",e,!1)}}}function s(t){return{x:(t.touches?t.touches[0].pageX:t.pageX)-H-G,y:(t.touches?t.touches[0].pageY:t.pageY)-H-z}}function c(t,e){t>E&&(E=t),e>T&&(T=e)}function d(){function n(){e.title="Draw! "+(r?"":a)+u+(r?a:""),r=!r,i=t.setTimeout(n,300)}var i,o=e.title,a=" ",u="✎",r=!0;return i=t.setTimeout(n,4e3),{stop:function(){t.clearTimeout(i),e.title=o}}}function h(i){H>0&&(D.push("margin"),f.style.left=H+"px",f.style.top=H+"px"),b&&(D.push("margin"),f.style.left=H+"px",f.style.top=H+"px"),D.length>0&&(f.className=D.join(" ")),t.addEventListener("resize",function(){n()},!1),n(),e.body.addEventListener("touchmove",function(t){t.preventDefault()},!1),f.addEventListener("mousedown",function(t){0===t.button&&(o(t),i&&(i.stop(),i=null))},!0),f.addEventListener("touchstart",function(t){t.preventDefault(),o(t),i&&(i.stop(),i=null)},!1),t.addEventListener("mouseup",a,!1),f.addEventListener("touchend",a,!1),v.onclick=function(){var e=f.width,i=f.height;n(E,T),E>0&&T>0&&(w.value=JSON.stringify(t.SCRICH_SETTINGS),I.value=f.toDataURL("image/png").replace(/^data:image\/png;base64,/,""),S.submit()),n(e,i)},m.onclick=function(){t.location=t.SCRICH_URL}}var g=function(t){return e.getElementById(t)},f=g("drawing"),v=g("save"),m=g("new"),p=g("img"),S=g("form"),I=g("new_drawing"),w=g("settings"),y=g("about"),E=0,T=0,C=!1,x=null,L=null,R=null,H=null,b=null,N=null,_=null,k=null,D=[],G=0,z=0;if(t.devicePixelRatio||1,!f.getContext)return t.alert("Your browser does not support canvas, you need to update it before using scri.ch."),void 0;x=f.getContext("2d"),L=e.createElement("canvas"),R=L.getContext("2d"),H=t.SCRICH_SETTINGS.margin||0,b=t.SCRICH_SETTINGS.background||"transparent",N=t.SCRICH_SETTINGS.foreground||"#000000",t.SCRICH_SETTINGS.size&&(_=t.SCRICH_SETTINGS.size.width||null,k=t.SCRICH_SETTINGS.size.height||null,H=0),e.onselectstart=function(){return!1};var P=t.loadImg=function(e,n){var i=new t.Image;i.onload=function(){f.width=E=i.width,f.height=T=i.height;try{x.drawImage(i,0,0)}catch(o){t.setTimeout(function(){P(e,n)},300)}n&&n()},i.src=e};p?P(p.src,h):h(d())})(this,this.document);