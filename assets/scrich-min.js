var f=null,h=false;
(function(c,s){function l(a,m){var g=e.getImageData(0,0,b.width,b.height);b.width=n||a||(c.innerWidth-d*2>i?c.innerWidth-d*2:i);b.height=o||m||(c.innerHeight-d*2>j?c.innerHeight-d*2:j);if(n)t=c.innerWidth/2-n/2,b.style.left=t+"px";if(o)u=c.innerHeight/2-o/2,b.style.top=u+"px";k.width=g.width;k.height=g.height;w.putImageData(g,0,0);if(p!=="transparent")e.fillStyle=p,e.fillRect(0,0,b.width,b.height);e.drawImage(k,0,0)}function x(a){var a=y(a),m=a.x,g=a.y,d=m+1,k=g+1;d>i&&(i=d);k>j&&(j=k);e.fillStyle=
v;e.fillRect(m-1,g-1,2,2);e.beginPath();e.moveTo(a.x,a.y);G();c.addEventListener("mousemove",q,h);b.addEventListener("touchmove",q,h)}function z(){e.stroke();c.removeEventListener("mousemove",q,h);b.removeEventListener("touchmove",q,h)}function G(){if(!A){A=true;for(var a=[B,C,H],b=function(a){a.stopPropagation()};a.length;){var c=a.shift();c.style.display="block";c.addEventListener("mousedown",b,h)}}}function q(a){a.preventDefault();var b=y(a),a=b.x,b=b.y,c=a+1,d=b+1;c>i&&(i=c);d>j&&(j=d);e.strokeStyle=
v;e.lineTo(a,b);e.stroke()}function y(a){return{x:(a.touches?a.touches[0].pageX:a.pageX)-d-t,y:(a.touches?a.touches[0].pageY:a.pageY)-d-u}}function D(){if(d>0)r.push("margin"),b.style.left=d+"px",b.style.top=d+"px";if(p)r.push("margin"),b.style.left=d+"px",b.style.top=d+"px";if(r.length>0)b.className=r.join(" ");c.addEventListener("resize",function(){l()},h);l();s.body.addEventListener("touchmove",function(a){a.preventDefault()},h);b.addEventListener("mousedown",function(a){a.button===0&&x(a)},true);
b.addEventListener("touchstart",function(a){a.preventDefault();x(a)},h);c.addEventListener("mouseup",z,h);b.addEventListener("touchend",z,h);B.onclick=function(){var a=b.width,d=b.height;l(i,j);if(i>0&&j>0)I.value=JSON.stringify(c.SCRICH_SETTINGS),J.value=b.toDataURL("image/png").replace(/^data:image\/png;base64,/,""),K.submit();l(a,d)};C.onclick=function(){c.location=c.SCRICH_URL}}var b=document.getElementById("drawing"),B=document.getElementById("save"),C=document.getElementById("new"),E=document.getElementById("img"),
K=document.getElementById("form"),J=document.getElementById("new_drawing"),I=document.getElementById("settings"),H=document.getElementById("about"),i=0,j=0,A=h,e=f,k=f,w=f,d=f,p=f,v=f,n=f,o=f,r=[],t=0,u=0;if(b.getContext){e=b.getContext("2d");k=s.createElement("canvas");w=k.getContext("2d");d=c.SCRICH_SETTINGS.margin||0;p=c.SCRICH_SETTINGS.background||"transparent";v=c.SCRICH_SETTINGS.foreground||"#000000";c.SCRICH_SETTINGS.size&&(n=c.SCRICH_SETTINGS.size.width||f,o=c.SCRICH_SETTINGS.size.height||
f,d=0);s.onselectstart=function(){return h};var F=c.a=function(a,d){var g=new Image;g.onload=function(){b.width=i=g.width;b.height=j=g.height;try{e.drawImage(g,0,0)}catch(k){c.setTimeout(function(){F(a,d)},300)}d&&d()};g.src=a};E?F(E.src,D):D()}else c.alert("Your browser does not support canvas, you need to update it before using scri.ch.")})(window,document);
